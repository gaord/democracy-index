<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Document</title>
<style>
.plot {
  background-color: #eee;
  width: 1200px;
  height: 600px;
}
svg {
  border: 1px dashed red;
}
</style>
</head>
<body>
<div class="plot"></div>
<script src="d3.min.js"></script>  
<script>

// Working force layout cartogram

let plot = d3.select(".plot")

const w = plot.node().clientWidth;
const h = plot.node().clientHeight;

plot = plot
  .append("svg")
  .attr("width",w)
  .attr("height",h);

const countryPromise = d3.json("data_countries.json")

Promise.all([countryPromise])
	.then(function([countryData]){
      
    drawMap(plot, countryData);
    
  });
  
const drawMap = function(plot, data){
  
  const projection = d3.geoEquirectangular()
    .scale((w/640)*100).translate([w/2, h/2])

  console.log(data);

  dataXY = data.map(d=>{
    d.x = projection([d.lng,d.lat])[0];
    d.y = projection([d.lng,d.lat])[1];
    return d;
  });
  
  var simulation = d3.forceSimulation(dataXY)
    .force('collision', d3.forceCollide().radius(5))
    .on('tick', ticked);

  function ticked() {
    var u = plot.selectAll('circle')
      .data(dataXY)

    u.enter()
      .append('circle')
      .attr('r', 5)
      .merge(u)
      .attr('cx', function(d) {
        return d.x
      })
      .attr('cy', function(d) {
        return d.y
      })
      .attr("fill","red")
      .attr("opacity",0.5)
      .attr("data-country",d=>d.country)

    u.exit().remove()
  }
    

}

</script>
</body>
</html>